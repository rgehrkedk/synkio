<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="dist/ui-styles.css">
</head>
<body>
  <!-- Segmented Control -->
  <div class="segmented-control" role="tablist">
    <button class="active" data-tab="import" role="tab" aria-selected="true">Import</button>
    <button data-tab="export" role="tab" aria-selected="false">Export JSON</button>
    <button data-tab="sync" role="tab" aria-selected="false">Sync to Node</button>
  </div>

  <!-- IMPORT TAB -->
  <div id="tab-import" class="tab-panel active">
    <div class="section">
      <div class="section-title">1. Upload Token Files</div>
      <div class="file-upload" id="dropZone">
        <div class="file-upload-icon">üìÅ</div>
        <div>Drop JSON files here or click to browse</div>
      </div>
      <input type="file" id="fileInput" accept=".json" multiple>
      <div class="file-list" id="fileList"></div>
    </div>

    <!-- Baseline Confirmation Section (hidden by default) -->
    <div id="baselineConfirmationSection" style="display: none;"></div>

    <!-- NEW: Structure Preview Section (hidden by default) -->
    <div id="structurePreviewSection" style="display: none;"></div>

    <!-- NEW: File Grouping Section (hidden by default, shown for multi-file imports) -->
    <div id="fileGroupingSection" style="display: none;">
      <div id="fileGroupingContainer"></div>
    </div>

    <!-- NEW: Multi-Collection Configuration Section (hidden by default, for multi-file imports) -->
    <div id="multiCollectionConfigSection" style="display: none;"></div>

    <!-- NEW: Level Selector Section (hidden by default, for single-file imports) -->
    <div id="levelSelectorSection" style="display: none;">
      <div id="levelSelectorContainer"></div>
    </div>

    <!-- NEW: Live Preview Section (hidden by default) -->
    <div id="livePreviewSection" style="display: none;">
      <div id="live-preview"></div>
    </div>
  </div>

  <!-- EXPORT JSON TAB -->
  <div id="tab-export" class="tab-panel">
    <div class="section">
      <div class="section-title">Export Variables as JSON</div>
      <div class="section-description">Select which collections to include in the export.</div>

      <div class="selection-controls">
        <button class="button button-ghost" id="exportSelectAll">Select All</button>
        <button class="button button-ghost" id="exportSelectNone">Select None</button>
      </div>

      <div id="exportCollectionList" class="collection-list">
        <div class="loading">
          <div class="spinner"></div>
          Loading collections...
        </div>
      </div>

      <div class="info-box">
        <div class="info-box-title">Export Format</div>
        <div class="info-box-text">
          Exports all selected variables as a baseline-snapshot.json file with nested token structure and flat baseline lookup.
        </div>
      </div>
    </div>
  </div>

  <!-- SYNC TO NODE TAB -->
  <div id="tab-sync" class="tab-panel">
    <div class="section">
      <div class="section-title">Sync to Node</div>
      <div class="section-description">Store variables in a hidden node for access via Figma REST API.</div>

      <div class="selection-controls">
        <button class="button button-ghost" id="syncSelectAll">Select All</button>
        <button class="button button-ghost" id="syncSelectNone">Select None</button>
      </div>

      <div id="syncCollectionList" class="collection-list">
        <div class="loading">
          <div class="spinner"></div>
          Loading collections...
        </div>
      </div>

      <!-- Last Sync Info -->
      <div id="lastSyncInfo" class="info-box" style="display: none; margin-bottom: 12px;">
        <div class="info-box-title" style="display: flex; align-items: center; gap: 6px;">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--figma-color-icon-success, #1e8e3e);">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          Last Sync
        </div>
        <div class="info-box-text" style="margin-top: 8px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <span>Node ID:</span>
            <span id="lastSyncNodeId" style="font-family: 'SF Mono', Monaco, monospace; cursor: pointer;" title="Click to copy">--</span>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <span>Variables:</span>
            <span id="lastSyncVariables">--</span>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span>Synced:</span>
            <span id="lastSyncTime">--</span>
          </div>
        </div>
      </div>

      <!-- Sync Changes Section (hidden by default) -->
      <div id="syncChangesSection" style="display: none;"></div>

      <!-- Check for Changes Button -->
      <div class="sync-actions" style="margin-bottom: 12px;">
        <button id="checkChangesBtn" class="button button-secondary" style="width: 100%;">
          Check for Changes
        </button>
      </div>

      <div class="info-box">
        <div class="info-box-title">How it works</div>
        <div class="info-box-text">
          Creates a hidden frame (_token_registry) that stores variable data as sharedPluginData. This data can then be fetched via the Figma REST API without needing Variables API access.
        </div>
      </div>
    </div>

    <!-- Sync Success Screen -->
    <div id="syncSuccessScreen" class="success-screen">
      <div class="success-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
      <div class="success-title">Sync Complete</div>
      <div class="success-description">
        Your variables have been synced to a hidden node and can now be accessed via the Figma REST API.
      </div>

      <div class="node-preview">
        <div class="node-preview-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          </svg>
        </div>
        <div class="node-preview-info">
          <div class="node-preview-name">_token_registry</div>
          <div class="node-preview-type">Hidden Frame</div>
        </div>
      </div>

      <div class="success-details">
        <div class="success-detail-row">
          <span class="success-detail-label">Node ID</span>
          <span class="success-detail-value copyable" id="syncNodeIdValue" title="Click to copy">
            <span class="node-id-text">--</span>
            <svg class="copy-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
          </span>
        </div>
        <div class="success-detail-row">
          <span class="success-detail-label">Variables Synced</span>
          <span class="success-detail-value" id="syncVariableCount">--</span>
        </div>
        <div class="success-detail-row">
          <span class="success-detail-label">Synced At</span>
          <span class="success-detail-value" id="syncTimestamp">--</span>
        </div>
      </div>

      <div class="copy-hint">Click the Node ID to copy it to clipboard</div>

      <div class="success-actions">
        <button class="button button-secondary" id="syncAgainBtn">Sync Again</button>
        <button class="button button-primary" id="closeSyncSuccessBtn">Done</button>
      </div>
    </div>
  </div>

  <!-- Action Footer -->
  <div class="action-footer">
    <button class="button button-secondary" id="cancelBtn">Cancel</button>
    <button class="button button-primary" id="actionBtn" disabled>Import to Figma</button>
  </div>

  <script src="dist/ui.js"></script>
</body>
</html>
