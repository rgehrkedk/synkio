{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://unpkg.com/@synkio/core/schemas/tokensrc.schema.json",
  "title": "Synkio Configuration",
  "description": "Configuration file for Synkio design token synchronization",
  "type": "object",
  "required": ["version", "figma", "paths"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference for IDE support"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Configuration version (e.g., '1.0.0')",
      "examples": ["1.0.0"]
    },
    "figma": {
      "$ref": "#/definitions/FigmaConfig"
    },
    "paths": {
      "$ref": "#/definitions/PathsConfig"
    },
    "split": {
      "type": "object",
      "description": "Collection split configuration",
      "additionalProperties": {
        "$ref": "#/definitions/CollectionSplitConfig"
      }
    },
    "build": {
      "$ref": "#/definitions/BuildConfig"
    },
    "migration": {
      "$ref": "#/definitions/MigrationConfig"
    },
    "collections": {
      "type": "object",
      "description": "Legacy collection configuration (deprecated)",
      "additionalProperties": true
    }
  },
  "definitions": {
    "FigmaConfig": {
      "type": "object",
      "description": "Figma API connection settings",
      "required": ["fileId", "accessToken"],
      "properties": {
        "fileId": {
          "type": "string",
          "description": "Figma file ID from URL (figma.com/file/{fileId}/...)",
          "pattern": "^[a-zA-Z0-9]+$",
          "examples": ["abc123xyz"]
        },
        "nodeId": {
          "type": "string",
          "description": "Optional: Registry node ID from Figma plugin",
          "examples": ["123:456"]
        },
        "accessToken": {
          "type": "string",
          "description": "Figma access token. Supports env var: ${FIGMA_ACCESS_TOKEN}",
          "examples": ["${FIGMA_ACCESS_TOKEN}", "figd_abc123..."]
        }
      }
    },
    "PathsConfig": {
      "type": "object",
      "description": "File and directory paths (relative to config file)",
      "required": ["data", "baseline", "baselinePrev", "reports", "tokens", "styles"],
      "properties": {
        "root": {
          "type": "string",
          "description": "Project root directory (optional)",
          "examples": ["."]
        },
        "data": {
          "type": "string",
          "description": "Data directory for baselines and internal files",
          "examples": ["figma-sync/.figma/data", ".figma"]
        },
        "baseline": {
          "type": "string",
          "description": "Baseline file path",
          "examples": ["figma-sync/.figma/data/baseline.json"]
        },
        "baselinePrev": {
          "type": "string",
          "description": "Previous baseline file for rollback",
          "examples": ["figma-sync/.figma/data/baseline.prev.json"]
        },
        "reports": {
          "type": "string",
          "description": "Reports directory",
          "examples": ["figma-sync/.figma/reports"]
        },
        "tokens": {
          "type": "string",
          "description": "Token output directory",
          "examples": ["tokens", "src/tokens"]
        },
        "styles": {
          "type": "string",
          "description": "Styles output directory (for generated CSS)",
          "examples": ["styles/tokens", "src/styles/tokens"]
        }
      }
    },
    "CollectionSplitConfig": {
      "type": "object",
      "description": "Configuration for splitting a single collection",
      "required": ["collection", "strategy", "output", "files"],
      "properties": {
        "collection": {
          "type": "string",
          "description": "Collection name from Figma",
          "examples": ["theme", "base", "primitives"]
        },
        "strategy": {
          "type": "string",
          "enum": ["byMode", "byGroup"],
          "description": "Split strategy: byMode (themes) or byGroup (primitives)",
          "examples": ["byMode", "byGroup"]
        },
        "output": {
          "type": "string",
          "description": "Base output directory for this collection",
          "examples": ["tokens/theme", "tokens/base"]
        },
        "files": {
          "type": "object",
          "description": "Explicit file mappings for each mode/group",
          "additionalProperties": {
            "type": "string"
          },
          "examples": [
            {
              "light": "tokens/theme/light.json",
              "dark": "tokens/theme/dark.json"
            }
          ]
        }
      }
    },
    "BuildConfig": {
      "type": "object",
      "description": "Build command configuration",
      "properties": {
        "command": {
          "type": "string",
          "description": "Shell command to run after sync",
          "examples": ["npm run tokens:build", "style-dictionary build"]
        },
        "styleDictionary": {
          "$ref": "#/definitions/StyleDictionaryConfig"
        }
      }
    },
    "StyleDictionaryConfig": {
      "type": "object",
      "description": "Style Dictionary integration settings",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether Style Dictionary integration is enabled",
          "default": false
        },
        "config": {
          "type": "string",
          "description": "Path to Style Dictionary config file",
          "examples": ["style-dictionary.config.mjs", "scripts/build-tokens.js"]
        },
        "version": {
          "type": "string",
          "enum": ["v3", "v4"],
          "description": "Detected Style Dictionary version",
          "examples": ["v4"]
        }
      }
    },
    "MigrationConfig": {
      "type": "object",
      "description": "Code migration settings for token name changes",
      "properties": {
        "autoApply": {
          "type": "boolean",
          "description": "Whether to automatically apply migrations (use with caution!)",
          "default": false
        },
        "platforms": {
          "type": "object",
          "description": "Platform-specific migration configurations",
          "additionalProperties": {
            "$ref": "#/definitions/PlatformConfig"
          }
        }
      }
    },
    "PlatformConfig": {
      "type": "object",
      "description": "Platform adapter configuration",
      "required": ["include", "exclude", "transform", "patterns"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether this platform is enabled",
          "default": true
        },
        "include": {
          "type": "array",
          "description": "Glob patterns for files to scan",
          "items": {
            "type": "string"
          },
          "examples": [["**/*.css", "**/*.scss"]]
        },
        "exclude": {
          "type": "array",
          "description": "Glob patterns for files to ignore",
          "items": {
            "type": "string"
          },
          "examples": [["**/node_modules/**", "**/dist/**"]]
        },
        "transform": {
          "$ref": "#/definitions/TransformConfig"
        },
        "patterns": {
          "type": "array",
          "description": "Regex patterns for finding token usage",
          "items": {
            "type": "string"
          },
          "examples": [["var\\(--{token}\\)", "var\\(--{token},"]]
        }
      }
    },
    "TransformConfig": {
      "type": "object",
      "description": "Token name transformation settings",
      "required": ["prefix", "separator", "case", "stripSegments"],
      "properties": {
        "prefix": {
          "type": "string",
          "description": "Prefix for token names",
          "examples": ["--", "$", "tokens."]
        },
        "separator": {
          "type": "string",
          "description": "Separator between token path segments",
          "examples": ["-", ".", "_"]
        },
        "case": {
          "type": "string",
          "enum": ["kebab", "camel", "snake", "pascal"],
          "description": "Case transformation for token names",
          "examples": ["kebab"]
        },
        "stripSegments": {
          "type": "array",
          "description": "Path segments to strip from token names",
          "items": {
            "type": "string"
          },
          "examples": [["base", "theme", "value", "light", "dark"]]
        }
      }
    }
  }
}
